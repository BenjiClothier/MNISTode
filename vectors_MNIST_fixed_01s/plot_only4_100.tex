\begin{figure}[htbp]
 \centering
\begin{tikzpicture}
\begin{groupplot}[
 group style={
 group size=1 by 2, % 1 column, 2 rows
 vertical sep=1.5cm, % Space between plots
 xlabels at=edge bottom, % Only bottom plot gets x-label
 },
 width=0.85\textwidth,
 height=5cm,
 grid=major,
 legend style={
 font=\small,
 /tikz/every even column/.append style={column sep=0.2em}
 },
 ]
% ===== TOP PLOT: Original comparison =====
\nextgroupplot[
 ylabel={$\log p(x)$},
 ymode=log,
 legend pos=south east,
 title={Likelihood Comparison: 1's (in dist) data vs 4's (out dist)},
 ]
% Mean line normal data
\addplot[blue, thick] table[x=timestep, y=mean, col sep=comma] {vectors_MNIST_fixed_01s/norm.csv};
\addlegendentry{Learned data \{1\}}
% Mean ± std shaded region norm
\addplot[name path=upper_norm, draw=none, forget plot]
 table[x=timestep, y=mean_plus_std, col sep=comma] {vectors_MNIST_fixed_01s/norm.csv};
\addplot[name path=lower_norm, draw=none, forget plot]
 table[x=timestep, y=mean_minus_std, col sep=comma] {vectors_MNIST_fixed_01s/norm.csv};
\addplot[blue!20, fill opacity=0.3] fill between[of=upper_norm and lower_norm];
\addlegendentry{Learned data std $\pm$}
% Mean line abnormal data
\addplot[red, thick] table[x=timestep, y=mean, col sep=comma] {vectors_MNIST_fixed_01s/only4_100.csv};
\addlegendentry{OOD 4's}
% Mean ± std shaded region abnormal data
\addplot[name path=upper_cats, draw=none, forget plot]
 table[x=timestep, y=mean_plus_std, col sep=comma] {vectors_MNIST_fixed_01s/only4_100.csv};
\addplot[name path=lower_cats, draw=none, forget plot]
 table[x=timestep, y=mean_minus_std, col sep=comma] {vectors_MNIST_fixed_01s/only4_100.csv};
\addplot[red!20, fill opacity=0.3] fill between[of=upper_cats and lower_cats];
\addlegendentry{OOD 4's std $\pm$}
% ===== BOTTOM PLOT: Difference =====
\nextgroupplot[
 xlabel={Timestep},
 ylabel={Difference},
 legend pos=south west,
 title={Difference (Learned - OOD)},
 ]
% Difference line
\addplot[green!50!black, thick] table[x=timestep, y=mean_diff, col sep=comma] {vectors_MNIST_fixed_01s/difference_4_100s.csv};
\addlegendentry{Mean difference}
% Optional: add std bands for difference
\addplot[name path=upper_diff, draw=none, forget plot]
 table[x=timestep, y=mean_diff_plus_std, col sep=comma] {vectors_MNIST_fixed_01s/difference_4_100s.csv};
\addplot[name path=lower_diff, draw=none, forget plot]
 table[x=timestep, y=mean_diff_minus_std, col sep=comma] {vectors_MNIST_fixed_01s/difference_4_100s.csv};
\addplot[green!20, fill opacity=0.3] fill between[of=upper_diff and lower_diff];
\addlegendentry{Difference std $\pm$}
% Zero reference line
\addplot[black, dashed, thin, forget plot] coordinates {(0,0) (99,0)};
\end{groupplot}
\end{tikzpicture}
\caption{Top: Comparison of learned (1's) vs OOD (4's) data likelihoods. Bottom: Difference between the two.}
\end{figure}
